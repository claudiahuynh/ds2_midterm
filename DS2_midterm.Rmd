---
title: "DS2_midterm"
author: "My An Huynh, Soomin You"
date: "`r Sys.Date()`"
output: github_document
---

```{r}
library(tidyverse)
library(MASS)
library(caret)
library(corrplot)
library(pROC)
library(mgcv)
```

## Load Data
```{r}
load("data/dat1.RData")
load("data/dat2.RData")
```

## Summary Statistics 
## Exploratory Data Analysis 
```{r}
train = dat1 |>
  dplyr::select(-id)


test = dat2 |> 
  dplyr::select(-id)

train2 = dat1 |> 
  dplyr::select(-id) |>
  mutate(
    gender = as.numeric(gender), 
    race = as.numeric(race), 
    smoking = as.numeric(smoking), 
    diabetes = as.numeric(diabetes)
  )
  

x = model.matrix(log_antibody ~ ., data = train)[, -1]
y = train$log_antibody

x2 = model.matrix(log_antibody ~ ., data = train2)[, -1]
y2 = train2$log_antibody

featurePlot(x = train[, -c(2,3,4,8,9, 13)], y = train$log_antibody, plot = "scatter")

#  boxplot for factor/binary variables 
ggplot(aes(x = factor(gender), y = log_antibody), data = train) + 
  geom_boxplot()
ggplot(aes(x = factor(race), y = log_antibody), data = train) + 
  geom_boxplot()
ggplot(aes(x = factor(race), y = log_antibody), data = train) + 
  geom_boxplot()
ggplot(aes(x = factor(diabetes), y = log_antibody), data = train) + 
  geom_boxplot()
ggplot(aes(x = factor(hypertension), y = log_antibody), data = train) + 
  geom_boxplot()
ggplot(aes(x = factor(smoking), y = log_antibody), data = train) + 
  geom_boxplot()


corrplot(cor(x), method = "circle", type = "full")

```


## Model training 
1) elastic net  
2) MARS 
3) PCR

4) GAM
5) smoothing splines 


```{r gam}
set.seed(1)
ctrl1 = trainControl(method = "cv", number = 10)

gam_mod = train(x = x, 
                y = y, 
                method = "gam", 
                trControl = ctrl1)

gam_mod$bestTune
gam_mod$finalModel

summary(gam_mod)
```

```{r}
set.seed(1)
enet_mod = train(log_antibody ~ ., 
                 data = train,
                 method = "glmnet", 
                 tuneGrid = expand.grid(alpha = seq(0, 1, length = 21), 
                                        lambda = exp(seq(6, 0, length = 100))),
                 trControl = ctrl1)

enet_mod$bestTune
```

```{r}
set.seed(1)
mars_mod = train(x = x, 
                 y = y, 
                 method = "earth", 
                 trControl = ctrl1)

summary(mars_mod)
```



## Model validation 
6) comparison 
```{r}
bwplot(resamples(list(MARS = mars_mod, 
                      GAM = gam_mod,
                      enet = enet_mod)),
       metric = "RMSE")
```

## Conclusion 

